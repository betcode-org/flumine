
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Betting trading framework">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../help/">
      
      
      <link rel="icon" href="../images/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>QuickStart - flumine</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#quickstart" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="flumine" class="md-header__button md-logo" aria-label="flumine" data-md-component="logo">
      
  <img src="../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            flumine
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              QuickStart
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/betcode-org/flumine" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    betcode-org/flumine
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Introduction

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../clients/" class="md-tabs__link">
          
  
  
  Advanced

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="flumine" class="md-nav__button md-logo" aria-label="flumine" data-md-component="logo">
      
  <img src="../images/logo.png" alt="logo">

    </a>
    flumine
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/betcode-org/flumine" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    betcode-org/flumine
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    QuickStart
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    QuickStart
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#live" class="md-nav__link">
    <span class="md-ellipsis">
      Live
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Live">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#order-placement" class="md-nav__link">
    <span class="md-ellipsis">
      Order placement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stream-class" class="md-nav__link">
    <span class="md-ellipsis">
      Stream class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#paper-trading" class="md-nav__link">
    <span class="md-ellipsis">
      Paper Trading
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simulation" class="md-nav__link">
    <span class="md-ellipsis">
      Simulation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listener-kwargs" class="md-nav__link">
    <span class="md-ellipsis">
      Listener kwargs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Event Processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#market-filter" class="md-nav__link">
    <span class="md-ellipsis">
      Market Filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation_1" class="md-nav__link">
    <span class="md-ellipsis">
      Simulation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../help/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Help
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Advanced
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../clients/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Clients
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Strategies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../trades/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trades / Orders
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../markets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Markets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../controls/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Controls
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Workers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sportsdata/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sports Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Advanced Usage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Performance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../known_issues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Known Issues
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#live" class="md-nav__link">
    <span class="md-ellipsis">
      Live
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Live">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#order-placement" class="md-nav__link">
    <span class="md-ellipsis">
      Order placement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stream-class" class="md-nav__link">
    <span class="md-ellipsis">
      Stream class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#paper-trading" class="md-nav__link">
    <span class="md-ellipsis">
      Paper Trading
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simulation" class="md-nav__link">
    <span class="md-ellipsis">
      Simulation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listener-kwargs" class="md-nav__link">
    <span class="md-ellipsis">
      Listener kwargs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Event Processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#market-filter" class="md-nav__link">
    <span class="md-ellipsis">
      Market Filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation_1" class="md-nav__link">
    <span class="md-ellipsis">
      Simulation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="quickstart">QuickStart</h1>
<h2 id="live">Live</h2>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>flumine uses <code>betfairlightweight</code> for communicating with the Betfair API, please see <a href="https://betcode-org.github.io/betfair/">docs</a> for how to use/setup before proceeding.</p>
</div>
<p>First, start by importing flumine/bflw and creating a trading and framework client:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">betfairlightweight</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flumine</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flumine</span><span class="p">,</span> <span class="n">clients</span>

<span class="n">trading</span> <span class="o">=</span> <span class="n">betfairlightweight</span><span class="o">.</span><span class="n">APIClient</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">clients</span><span class="o">.</span><span class="n">BetfairClient</span><span class="p">(</span><span class="n">trading</span><span class="p">)</span>

<span class="n">framework</span> <span class="o">=</span> <span class="n">Flumine</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>flumine will handle login, logout and keep alive whilst the framework is running using the <code>keep_alive</code> worker.</p>
</div>
<p>A strategy can now be created by using the BaseStrategy class:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">flumine</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseStrategy</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ExampleStrategy</span><span class="p">(</span><span class="n">BaseStrategy</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flumine</span><span class="p">):</span>
        <span class="c1"># subscribe to streams</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;starting strategy &#39;ExampleStrategy&#39;&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_market_book</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">market</span><span class="p">,</span> <span class="n">market_book</span><span class="p">):</span>
        <span class="c1"># process_market_book only executed if this returns True</span>
        <span class="k">if</span> <span class="n">market_book</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;CLOSED&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_market_book</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">market</span><span class="p">,</span> <span class="n">market_book</span><span class="p">):</span>
        <span class="c1"># process marketBook object</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">market_book</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
</code></pre></div>

<p>This strategy can now be initiated with the market and data filter before being added to the framework:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">betfairlightweight.filters</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">streaming_market_filter</span><span class="p">,</span> 
    <span class="n">streaming_market_data_filter</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">strategy</span> <span class="o">=</span> <span class="n">ExampleStrategy</span><span class="p">(</span>
    <span class="n">market_filter</span><span class="o">=</span><span class="n">streaming_market_filter</span><span class="p">(</span>
        <span class="n">event_type_ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;7&quot;</span><span class="p">],</span>
        <span class="n">country_codes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GB&quot;</span><span class="p">],</span>
        <span class="n">market_types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;WIN&quot;</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="n">market_data_filter</span><span class="o">=</span><span class="n">streaming_market_data_filter</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;EX_ALL_OFFERS&quot;</span><span class="p">])</span>
<span class="p">)</span>

<span class="n">framework</span><span class="o">.</span><span class="n">add_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
</code></pre></div>

<p>The framework can now be started:</p>
<div class="codehilite"><pre><span></span><code><span class="n">framework</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>

<h3 id="order-placement">Order placement</h3>
<p>Orders can be placed as followed:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">flumine.order.trade</span><span class="w"> </span><span class="kn">import</span> <span class="n">Trade</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flumine.order.order</span><span class="w"> </span><span class="kn">import</span> <span class="n">LimitOrder</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ExampleStrategy</span><span class="p">(</span><span class="n">BaseStrategy</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">process_market_book</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">market</span><span class="p">,</span> <span class="n">market_book</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">runner</span> <span class="ow">in</span> <span class="n">market_book</span><span class="o">.</span><span class="n">runners</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">runner</span><span class="o">.</span><span class="n">selection_id</span> <span class="o">==</span> <span class="mi">123</span><span class="p">:</span>
                <span class="n">trade</span> <span class="o">=</span> <span class="n">Trade</span><span class="p">(</span>
                    <span class="n">market_id</span><span class="o">=</span><span class="n">market_book</span><span class="o">.</span><span class="n">market_id</span><span class="p">,</span> 
                    <span class="n">selection_id</span><span class="o">=</span><span class="n">runner</span><span class="o">.</span><span class="n">selection_id</span><span class="p">,</span>
                    <span class="n">handicap</span><span class="o">=</span><span class="n">runner</span><span class="o">.</span><span class="n">handicap</span><span class="p">,</span>
                    <span class="n">strategy</span><span class="o">=</span><span class="bp">self</span>
                <span class="p">)</span>
                <span class="n">order</span> <span class="o">=</span> <span class="n">trade</span><span class="o">.</span><span class="n">create_order</span><span class="p">(</span>
                    <span class="n">side</span><span class="o">=</span><span class="s2">&quot;LAY&quot;</span><span class="p">,</span> 
                    <span class="n">order_type</span><span class="o">=</span><span class="n">LimitOrder</span><span class="p">(</span><span class="n">price</span><span class="o">=</span><span class="mf">1.01</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">2.00</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">market</span><span class="o">.</span><span class="n">place_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
</code></pre></div>

<p>This order will be validated through controls, stored in the blotter and sent straight to the execution thread pool for execution. It is also possible to batch orders into transactions as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="k">with</span> <span class="n">market</span><span class="o">.</span><span class="n">transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
    <span class="n">market</span><span class="o">.</span><span class="n">place_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>  <span class="c1"># executed immediately in separate transaction</span>
    <span class="n">t</span><span class="o">.</span><span class="n">place_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>  <span class="c1"># executed on transaction __exit__</span>

<span class="k">with</span> <span class="n">market</span><span class="o">.</span><span class="n">transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
    <span class="n">t</span><span class="o">.</span><span class="n">place_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>

    <span class="n">t</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c1"># above order executed</span>

    <span class="n">t</span><span class="o">.</span><span class="n">cancel_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">place_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>  <span class="c1"># both executed on transaction __exit__</span>
</code></pre></div>

<h3 id="stream-class">Stream class</h3>
<p>By default the stream class will be a MarketStream which provides a MarketBook python object, if collecting data this can be changed to a DataStream class however process_raw_data will be called and not process_market_book:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">flumine</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseStrategy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flumine.streams.datastream</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataStream</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ExampleDataStrategy</span><span class="p">(</span><span class="n">BaseStrategy</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">process_raw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">publish_time</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">publish_time</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="n">strategy</span> <span class="o">=</span> <span class="n">ExampleDataStrategy</span><span class="p">(</span>
    <span class="n">market_filter</span><span class="o">=</span><span class="n">streaming_market_filter</span><span class="p">(</span>
        <span class="n">event_type_ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;7&quot;</span><span class="p">],</span>
        <span class="n">country_codes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GB&quot;</span><span class="p">],</span>
        <span class="n">market_types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;WIN&quot;</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="n">stream_class</span><span class="o">=</span><span class="n">DataStream</span>
<span class="p">)</span>

<span class="n">flumine</span><span class="o">.</span><span class="n">add_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
</code></pre></div>

<p>The OrderDataStream class can be used to record order data as per market:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">flumine.streams.datastream</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderDataStream</span>

<span class="n">strategy</span> <span class="o">=</span> <span class="n">ExampleDataStrategy</span><span class="p">(</span>
    <span class="n">market_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">stream_class</span><span class="o">=</span><span class="n">OrderDataStream</span>
<span class="p">)</span>

<span class="n">flumine</span><span class="o">.</span><span class="n">add_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
</code></pre></div>

<h2 id="paper-trading">Paper Trading</h2>
<p>Flumine can be used to paper trade strategies live using the following code:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">flumine</span><span class="w"> </span><span class="kn">import</span> <span class="n">clients</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">clients</span><span class="o">.</span><span class="n">BetfairClient</span><span class="p">(</span><span class="n">trading</span><span class="p">,</span> <span class="n">paper_trade</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<p>Market data will be recieved as per live but any orders will use Simulated execution and Simulated order polling to replicate live trading.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This can be handy when testing strategies as the betfair website can be used to validate the market.</p>
</div>
<h2 id="simulation">Simulation</h2>
<p>Flumine can be used to simulate strategies using the following code:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">flumine</span><span class="w"> </span><span class="kn">import</span> <span class="n">FlumineSimulation</span><span class="p">,</span> <span class="n">clients</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">clients</span><span class="o">.</span><span class="n">SimulatedClient</span><span class="p">()</span>
<span class="n">framework</span> <span class="o">=</span> <span class="n">FlumineSimulation</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>

<span class="n">strategy</span> <span class="o">=</span> <span class="n">ExampleStrategy</span><span class="p">(</span>
    <span class="n">market_filter</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;markets&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/tmp/marketdata/1.170212754&quot;</span><span class="p">]}</span>
<span class="p">)</span>
<span class="n">framework</span><span class="o">.</span><span class="n">add_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>

<span class="n">framework</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>

<p>Note the use of market filter to pass the file directories.</p>
<h3 id="listener-kwargs">Listener kwargs</h3>
<p>Sometimes a subset of the market lifetime is required, this can be optimised by limiting the number of updates to process resulting in faster simulation:</p>
<div class="codehilite"><pre><span></span><code><span class="n">strategy</span> <span class="o">=</span> <span class="n">ExampleStrategy</span><span class="p">(</span>
    <span class="n">market_filter</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;markets&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/tmp/marketdata/1.170212754&quot;</span><span class="p">],</span>
        <span class="s2">&quot;listener_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;inplay&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;seconds_to_start&quot;</span><span class="p">:</span> <span class="mi">600</span><span class="p">},</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>

<ul>
<li>inplay: Filter inplay flag</li>
<li>seconds_to_start: Filter market seconds to start</li>
<li>max_inplay_seconds: Filter market on max seconds after market turned inplay</li>
<li>calculate_market_tv: As per bflw listener arg</li>
<li>cumulative_runner_tv: As per bflw listener arg</li>
</ul>
<p>The extra kwargs above will limit processing to preplay in the final 10 minutes.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Multiple strategies and markets can be passed, flumine will pass the MarketBooks to the correct strategy via its subscription.</p>
</div>
<h3 id="event-processing">Event Processing</h3>
<p>It is also possible to process events with multiple markets such as win/place in racing or all football markets as per live by adding the following flag:</p>
<div class="codehilite"><pre><span></span><code><span class="n">strategy</span> <span class="o">=</span> <span class="n">ExampleStrategy</span><span class="p">(</span>
    <span class="n">market_filter</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;markets&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">..</span><span class="p">],</span> <span class="s2">&quot;event_processing&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div>

<p>To process multiple events in parallel, provide a mapping for event groups in the format <code>{event_id: event_group}</code>. In this example, events with IDs <code>"123"</code> and <code>"456"</code> are added to execution group <code>"A"</code> and will be simulated together.</p>
<div class="codehilite"><pre><span></span><code><span class="n">strategy</span> <span class="o">=</span> <span class="n">ExampleStrategy</span><span class="p">(</span>
    <span class="n">market_filter</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;markets&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">..</span><span class="p">],</span> <span class="s2">&quot;event_processing&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;event_groups&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;123&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;456&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">}}</span>
<span class="p">)</span>
</code></pre></div>

<p>The <code>Market</code> object contains a helper method for accessing other event linked markets:</p>
<div class="codehilite"><pre><span></span><code><span class="n">place_market</span> <span class="o">=</span> <span class="n">market</span><span class="o">.</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;PLACE&quot;</span><span class="p">]</span>
</code></pre></div>

<h3 id="market-filter">Market Filter</h3>
<p>When simulating you can filter markets to be processed by using the <code>market_type</code> and <code>country_code</code> filter as per live:</p>
<div class="codehilite"><pre><span></span><code><span class="n">strategy</span> <span class="o">=</span> <span class="n">ExampleStrategy</span><span class="p">(</span>
    <span class="n">market_filter</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;markets&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">..</span><span class="p">],</span> 
        <span class="s2">&quot;market_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;MATCH_ODDS&quot;</span><span class="p">],</span> 
        <span class="s2">&quot;country_codes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;GB&quot;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="simulation_1">Simulation</h3>
<p>Simulation uses the <code>SimulatedExecution</code> execution class and tries to accurately simulate matching with the following:</p>
<ul>
<li>Estimated Place/Cancel/Replace latency delay added (can be changed in the config)</li>
<li>Betfair betDelay added based on market state</li>
<li>Queue positioning based on liquidity available</li>
<li>Order lapse on market version change</li>
<li>Order lapse and reduction on runner removal</li>
<li>BSP</li>
</ul>
<p>Limitations #192:</p>
<ul>
<li>Queue cancellations</li>
<li>Double counting of liquidity (active)</li>
<li>Currency fluctuations</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.tabs.sticky"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>